# Day 1

## 域名

### 什么是域名？

域名就是我们说的地址的名称，比如www.baidu.com。由于ip地址不方便记忆，设计出了域名，并通过**网域名称系统**（**DNS**）来将域名和IP地址相互映射，使人更方便地访问互联网，而不用去记住能够被机器**直接读取**的**IP地址数串**。

### 域名在哪里注册？

阿里万网或者腾讯域名注册都有。

### 什么是二级域名多级域名？

例如www.baidu.com，www是首域名，这个网址进入**百度搜索**。

**tieba.baidu.com**是进入**百度贴吧**。

**news.baidu.com**是进入**百度新闻**。

像**tieba，news**这种 就称为 二级域名。

如果前面还有就称为**三级域名**或者**多级域名**

### 域名发现对于安全测试意义？

安全测试的主要目的：举例来说，检测一个主站的安全性，模拟渗透进去。但是主站没有什么漏洞，这时候如果发现主站和他的一个分站--管理系统共用一个ip地址（区别只在于一个二级域名一个www）（也就是说两个域名解析出来的ip地址相同）他的分站有漏洞，那么就可以通过分站的漏洞逐步获取主站的权限。

所以收集域名会让我们的突破多一种可能。

## DNS

### 什么是DNS？

**域名系统（服务）协议**

设置的域名与ip地址的对应关系就是通过DNS去解析

### 本地HOSTS与DNS的关系？

**host文件**

存在于Windows系统，无扩展名的系统文件。主要是为了“绑定”域名和ip地址。当我们访问网站时，输入域名进行访问，正常情况下会有一个DNS解析的过程，而Host文件会在[域名解析](https://so.csdn.net/so/search?q=域名解析&spm=1001.2101.3001.7020)前，查看当前文件中是否存在域名对应的IP地址，如果存在，则会直接打开对应网页，缩减了解析时间。如果不存在，则系统会进行DNS域名解析。

**在测试中，经常会用到host。**

1、Host存在于C:\WINDOWS\System32\drivers\etc文件夹中

2、将本地IP地址与一个虚拟的域名关联，可以通过自定义的域名去访问（类似于钓鱼网站原理，界面一模一样，但是输入的数据被转存到其他服务器了）

3、网站部署在内网环境，可以把域名关联上内部的测试服务器

4、部分网站如果dns被屏蔽就无法进行解析，会报错。如果在host中进行关联就可以恢复正常。

**且每个地区解析出来的ip地址不一样**

### CDN是什么？与DNS的关系？

**CDN是 内容分发网络**。其目的是通过在现有的internet中增加一层新的网络[架构](https://so.csdn.net/so/search?q=架构&spm=1001.2101.3001.7020)，将网站的内容发布到最接近用户的网络边缘，使用户可以就近取得所需的内容，提高用户访问网站的响应速度。CDN有别于镜像，因为它比镜像更智能，或者可以做这样一个比喻：CDN=更智能的镜像+缓存+流量导流。因而，CDN可以明显提高Internet网络中信息流动的效率。从技术上全面解决由于网络带宽小、用户访问量大、网点分布不均等问题，提高用户访问网站的响应速度。

当用户访问已经加入CDN服务的网站时，首先通过DNS重定向技术确定最接近用户的最佳CDN节点，同时将用户的请求指向该节点。当用户的请求到达指定节点时，CDN的服务器（节点上的高速缓存）负责将用户请求的内容提供给用户。具体流程为: 用户在自己的浏览器中输入要访问的网站的域名，浏览器向本地DNS请求对该域名的解析，**本地DNS将请求发到网站的主DNS，主DNS根据一系列的策略确定当时最适当的CDN节点**，并将解析的结果（IP地址）发给用户，用户向给定的CDN节点请求相应网站的内容。

就是说，我们访问的网站一般不是源站，而是一个就近的CDN节点缓存。**如果我们对这个网站进行扫描或者安全监测，那么只是扫描或者安全监测的一个缓存，没有意义。**

### 常见的DNS安全攻击有哪些？

DNS劫持，DNS投毒。

如果DNS被攻击，那么域名和ip地址的解析不正确，会导致用户在访问域名的时候会被恶意指向到恶意地址。（俗称：被黑）

## 脚本语言

### 常见的脚本语言类型有哪些？

Javaweb(大型网站) py php（小中型网站）等

### 不同脚本类型与安全漏洞的关系？

不同语言的严谨性和安全性不同，这与发现漏洞的概率相关联。

### 漏洞挖掘代码审计与脚本类型的关系？

代码的规范性和条条框框决定漏洞出现的可能性。

## 后门

### 什么是后门？有哪些后门？

后门可以便于使用者轻易获取一些权限和文件。后门的形式也是多种多样的，有网站后门（webshell），服务器后门（远控木马）等等。

### 后门在安全测试中的实际意义？

可以更方便的进入系统

提供操作系统的通道

### 关于后门需要了解哪些？（玩法、免杀）

玩法：各种各样的触发条件等，目的就是为了 更好控制和更隐蔽。

**免杀：避免被杀毒软件检测到。**

## WEB

### WEB的组成架构模型？

网站源码：分脚本类型、分应用方向（方向不同所使用的函数就不同，那么漏洞也会不同）

操作系统：Windows，Linux。**攻击方式**不一样，不同操作系统漏洞不同

中间件（搭建平台）：apache iis tomcat nginx等。**提供服务**

数据库：access mysql mssql oracle sybase db2 postsql等

### 架构漏洞安全测试简要介绍？

先找出漏洞是在以上模型的哪个层面，然后再逐步渗透。

### 为什么要从WEB层面为主为首？

web的泛用性，从web层面开始渗透的难易度。

## WEB相关安全漏洞

**WEB源码类对应漏洞**

SQL注入，上传，xss，代码执行，变量覆盖，逻辑漏洞，反序列化等。

**WEB中间件对应漏洞**

**WEB数据库对应漏洞**

**WEB系统层对应漏洞**

**其他第三方对应漏洞**

**APP或PC应用结合类**

app上的界面其实是从网站上移植过来的，如果对app进行web抓包，那么就可以抓到相应的网址。

- 逆向
- web移动端转到电脑pc端分析

## 演示案例

### 多级域名的枚举查找（原理，方式）

​		直接查找youku.com

​		批量爆破工具Layer.exe

​		运营商第三方接口

​		阿里云域名注册查询

​				域名查询a记录：在提示符下直接输入域名，可查到该域名的A记录，其中“Non-authoritative 				answer”表示查询结果是从DNS的cache里返回的；

​				输入set type=mx，再输入域名，可查询MX记录；

​				输入set type=cname，再输入域名，可查询CNAME记录；

​				输入set type=ns，再输入域名，可查询NS记录。

### DNS 解析修改后分析（本地或服务）

各种记录分析

### EXE 后门功能及危害及类似 WEB 后门

安装后门软件在虚拟机服务，并进行监听

### APP 类结合 WEB 协议，PC 类结合 WEB 协议

Burpsite专门抓web协议数据包

​		配置IP地址——本机ip
​		proxy下的http history可以获取历史访问网站
​		可以抓包、反向发送回去

# DAY 2

## HTTP/S数据包

我们与浏览器进行交互时，是通过数据包进行的。浏览器与网站服务器会有两个过程

Request 请求数据包

Response 返回数据包

如果中间有代理（Proxy），那么同上。

### 关于HTTP和HTTPS

- HTTP 明文传输，数据都是未加密的，无状态协议，而HTTPS数据传输过程是加密的，安全性较好。
- HTTP 页面响应速度比 HTTPS 快。
- HTTP 和 HTTPS 使用的是完全不同的连接方式，用的端口也不一样。
- 使用 HTTPS 协议需要到 CA申请证书，SSL协议。

![image-20230706141640514](C:/Users/龚曦/AppData/Roaming/Typora/typora-user-images/image-20230706141640514.png)

1. 浏览器建立与web服务器之间的连接。
2. 浏览器将请求数据打包(生成请求数据包)并发送到web服务器。
3. web服务器将处理结果打包(生成响应数据包)并发送给浏览器。
4. web服务器关闭连接
5. Request请求数据包数据格式

## Requset数据包数据格式

**一个HTTP请求报文由四个部分组成:请求行、请求头、空行和请求数据。**

### 1）请求行：请求类型/请求资源路径、协议的版本和类型

​		请求行由三个标记组成：请求方法、请求URL和HTTP版本，它们用空格分隔。
​		例如： GET /index.html HTTP/1.1
​		HTTP 规划定义了8种可能的请求方法：

GET：检索URL中标识资源的一个简单请求
HEAD：与GET方法相同，服务器只返回状态行和头标，并不返回请求文档
POST：服务器接收被写入客户端输出流中数据的请求
PUT：服务器保存请求数据作为指定URL新内容的请求
DELETE：服务器删除URL中命令的资源的请求
OPTIONS：关于服务器支持的请求方法信息的请求
TRACE：web服务器反馈HTTP请求和其头标的请求
CONNECT：已文档化，但当前未实现的一个方法，预留做隧道处理

### 2）请求头：由关键字/值对组成，每行一对，关键字和值用冒号分享

HOST：主机或域名地址
Accept：指浏览器或其他客户可以接受的MIME文件格式，servlet可以根据它判断并返回适当的文件格式
**User-Agent：是客户浏览器名称**
**Host：对应网址URL中的web名称和端口号**
Accept-Language：指出浏览器可以接受的语言种类，如en或者en-us，指英语
connection：用来告诉服务器是否可以维持固定的HTTP连接、http是无连接的，HTTP/1.1使用Keep-Alive为默认值，这样当浏览器需要多个文件时（比如一个HTML文件和相关的图形文件），不需要每次都建立连接
Cookie：浏览器用这个属性向服务器发送Cookie。Cookie是在浏览器中寄存的小型数据体，他可以记载服务器相关的用户信息，也可以用来实现会话功能
**Referer：表明产生请求的网页URL，这个属性可以用来跟踪web请求是从什么网站来的。如比从网页/icconcept/index.jsp中点击一个链接到网页/icwork/search，再向服务器发送的GET/icwork/search中的请求中，Referer是http://hostname:8080/icconcept/index.jsp**
Content-Type：用来表明request的内容类型，可以用HttpServeletRequest的getContentType()方法取得。
Accept-Charset：指出浏览器可以接受的字符编码
Accept-Encoding：指出浏览器可以接受的编码方式。编码方式不同于文件格式，它是为了压缩文件传递速度。浏览器在接收到web响应之后再解码，然后再检查文件格式

### 3）空行：请求头与请求体之间用一个空行隔开

最后一个请求头标之后是空行，发送回车符和退行，通知服务器以下不再有头标。

### 4）请求数据

使用POST传送，最常使用的是Content-Type和Content-Length头标


## Response返回数据包格式

**一个响应由四个部分组成：状态行、响应头标、空行、响应数据；**

### 1）状态行：协议版本，数字形式的状态代码和状态描述，各元素之间用空格进行分割

**HTTP响应码**

1XX：信息，请求收到，继续处理
2XX：成功，行为被成功的接收、理解和采纳
3XX：重定向，为了完成请求，必须进一步执行的动作
4XX：客户端错误
5XX：服务器错误

200：存在文件
403：存在文件夹
3XX：均可能存在 ，可能在其他路径
404：不存在文件及文件夹
500：均可能存在，只是服务器响应失败，不代表不存在

### 3）响应头标：包含服务器类型、日期、长度、内容类型等

像请求头标一样，它们指出服务器的功能，标识出响应数据的细节。

### 4）空行：响应头与响应体之间用空行隔开

最后一个响应头标之后是一个空行，发送回车符和退行，表面服务器以下不再有头标。

### 5）响应数据：浏览器会将实体内容中的数据取出来，生成相应的页面

HTML文档和图像等，也就是HTML本身。

# DAY3

## 常见搭建平台脚本启用

ASP,PHP,ASPX,JSP,PY,JAVAWEB等环境

## 域名IP目录解析安全问题

IP地址可以访问发现更多内容，而域名访问只能发现一个文件夹下的所有文件。IP地址访问可以发现程序源码备份文件和敏感信息。访问网站的时候，可以访问域名，也可以访问IP地址。访问域名一般会指向某个目录，而访问IP地址一般会指向根目录；

## 常见文件后缀解析对应安全

指定后缀名对应某个文件，访问网站出现遇到不能解析的文件就是中间件可能默认或者添加某些设置导致解析时出现问题。

![1](https://img-blog.csdnimg.cn/8dbbdeb8772d462a99787901ce0370c7.png#pic_center)

## 常见安全测试中的安全防护

学校内网和企业内外会出现。会限制外部人员访问内部的网站，限制IP地址，规范访问者的权限。
身份验证和访问控制，基于用户的限制。

![1](https://img-blog.csdnimg.cn/16ca5b979fdc45bf8ab59a4824d0072a.png#pic_center)

授权访问—只允许指定IP地址访问，拒绝访问—拒绝指定IP地址访问；


![在这里插入图片描述](https://img-blog.csdnimg.cn/dfe7fd3628144775949bd35eeec210bf.png#pic_center)

然后可能会遇到用户权限限制

![img](https://img-blog.csdnimg.cn/20211011214412344.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5LiD54K55Y-q,size_14,color_FFFFFF,t_70,g_se,x_16)

这样设置的话我们就单单不能编辑文件，但是可以进行其他操作。如果全部拒绝呢？这个就是文件夹设置相关权限，他禁止wesite来宾用户的一个权限，导致连接的后门看不到任何东西，他也是一个防护技巧，也是测试里面经常碰上的一类问题。

![img](https://img-blog.csdnimg.cn/20211011214434991.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5LiD54K55Y-q,size_20,color_FFFFFF,t_70,g_se,x_16)

这里就是不给执行权限，导致后门无法执行。解决思路就是把 后门放到其他可执行的文件下，比如根目录。因为根目录不可能不给予执行权限，否则网站无法被访问。

## 演示案例

### 1.基于中间件的简要识别

​		通过抓取数据包的返回结果来识别中间件(server开头)

### 2.基于中间件的安全漏洞

（一） IIS
1、PUT漏洞
2、短文件名猜解
3、远程代码执行
4、解析漏洞

（二） Apache
1、解析漏洞
2、目录遍历

（三） Nginx
1、文件解析
2、目录遍历
3、CRLF注入
4、目录穿越

（四）Tomcat
1、远程代码执行
2、war后门文件部署

（五）jBoss
1、反序列化漏洞
2、war后门文件部署

（六）WebLogic
1、反序列化漏洞
2、SSRF
3、任意文件上传
4、war后门文件部署

（七）其它中间件相关漏洞
1、FastCGI未授权访问、任意命令执行
2、PHPCGI远程代码执行
[Web中间件常见漏洞总结 - FreeBuf网络安全行业门户](https://www.freebuf.com/articles/web/192063.html)

### 3.基于中间件的靶场使用

# DAY4

![第四天](https://img-blog.csdnimg.cn/0362c109140840e081639b91061dc813.png#pic_center)

[5. 语言与框架 — Web安全学习笔记 1.0 文档 (websec.readthedocs.io)](https://websec.readthedocs.io/zh/latest/language/index.html)

## 关于Web源码目录结构

数据库配置文件、后台目录、模板目录、数据库目录等

自己下载了一份源码，用来观察。

![image-20230709134408116](C:/Users/龚曦/AppData/Roaming/Typora/typora-user-images/image-20230709134408116.png)

index.asp 根据文件后缀名判断
admin 网站后台路径
data 数据相关的目录
install 安装相关的目录（我下载的源码中没有install这个目录）
member 会员相关的目录（我下载的源码中没有member这个目录）
template 模板目录（和网站的架构有关）
include 数据库配置文件可能在里面

------

下载的这个源码中并没有找到数据库配置文件，不过听了讲课，数据库配置文件，网站和数据库的通讯信息，连接账号密码，可以去连接对方数据库，从数据库去得到这个网站的源码里面涉及到的管理员的账号密码。



## 关于Web源码应用分类

之前图片里面的分类：

门户：综合类漏洞
电商：业务逻辑突出
论坛：xss逻辑突出
博客：漏洞较少
第三方：据功能决定
社交，论坛，门户，第三方，博客等不同的代码机制对应漏洞。
开源，未开源问题，框架非框架问题，关于CMS识别问题及后续等。
拿到对方的源码或者判断这个网站的应用类型之后应该侧重在哪些漏洞上做文章。

## 关于Web源码其他说明

如果对方网站采用的是框架开发的话那么你面对的就是寻找框架的漏洞，如果是非框架的话寻找的漏洞针对的是代码写出来的漏洞
CMS识别：判定一个网站是用什么程序搭建的。
开源：去网上找寻漏洞文章。内部：常规的渗透测试，用扫描工具去判断。
关于源码的获取途径：搜索，闲鱼淘宝，第三方源码站，各种行业对应。

**CMS识别工具**

1）在线工具：[潮汐指纹识别](http://finger.tidesec.net/)，[云悉指纹](https://www.yunsee.cn/)

2）本地工具 whatweb
御剑web指纹识别程序 百度网盘
大禹CMS识别程序	